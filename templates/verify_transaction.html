{% extends "base.html" %}

{% block title %}Verify Transactions - CCFD System{% endblock %}

{% block content %}
<section id="verify-transaction" class="mb-5">
    <h2 class="section-title">Verify Transaction</h2>
    <div class="card">
        <div class="card-body">
            <form id="transaction-form">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="cardNumber" class="form-label">Card Number</label>
                        <input type="text" class="form-control" id="cardNumber" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="amount" class="form-label">Amount</label>
                        <input type="number" class="form-control" id="amount" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="timestamp" class="form-label">Time Since Transaction (in seconds)</label>
                        <input type="number" class="form-control" id="timestamp" placeholder="Enter time in seconds" required>
                    </div>
                </div>
                <button type="button" class="btn btn-primary" id="verify-btn">Verify Transaction</button>
            </form>
            <div id="result" class="mt-3"></div>
        </div>
    </div>
</section>

<script>
    document.getElementById("verify-btn").addEventListener("click", function () {
        const amount = document.getElementById("amount").value;
        const timestamp = document.getElementById("timestamp").value;

        if (amount && timestamp) {
            fetch("/classify-transaction", {  <!-- Updated URL -->
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ amount: amount, timestamp: timestamp })
            })
            .then((response) => response.json())
            .then((data) => {
                const resultDiv = document.getElementById("result");
                if (data.status === "success") {
                    resultDiv.innerHTML = `<p class="alert alert-info">Transaction is <strong>${data.result}</strong>.</p>`;
                } else {
                    resultDiv.innerHTML = `<p class="alert alert-danger">${data.message}</p>`;
                }
            })
            .catch((error) => {
                console.error("Error:", error);
                document.getElementById("result").innerHTML = `<p class="alert alert-danger">An error occurred while verifying the transaction.</p>`;
            });
        } else {
            alert("Please fill in all required fields.");
        }
    });
</script>

{% endblock %}
